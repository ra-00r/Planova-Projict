<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Planova – Dashboard</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

<div class="app-layout">

  <!-- SIDEBAR -->

  <aside class="sidebar">
    <div class="sidebar-logo">
      <div class="logo-icon">
        <svg viewBox="0 0 24 24" fill="white"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
      </div>
      <span class="logo-text">planova</span>
    </div>
    <nav class="sidebar-nav">
      <a href="index.html" class="nav-item">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
        Dashboard
      </a>
      <a href="tasks.html" class="nav-item">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"/></svg>
        Tasks
      </a>
      <a href="exams.html" class="nav-item">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
        Exams
      </a>
      <a href="study-plan.html" class="nav-item">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/></svg>
        Study Plan
      </a>
      <a href="performance.html" class="nav-item">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
        Performance
      </a>
      <a href="notifications.html" class="nav-item">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/></svg>
        Notifications
      </a>
    </nav>
    <div class="sidebar-user">
      <div class="sidebar-avatar" id="sidebar-avatar">SA</div>
      <div class="sidebar-user-info">
        <div class="sidebar-user-name" id="sidebar-user-name">Loading...</div>
        <div class="sidebar-user-role">Student</div>
      </div>
      <button class="btn-logout" id="btn-logout" title="Logout">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/></svg>
      </button>
    </div>
  </aside>

  <!-- MAIN CONTENT -->

  <div class="main-content">

```
<!-- TOPBAR -->
<header class="topbar">
  <div class="topbar-left">
    <div class="topbar-title">Dashboard</div>
    <div class="topbar-subtitle" id="topbar-date">Overview of your academic progress</div>
  </div>
  <div class="topbar-right">
    <a href="notifications.html" class="topbar-icon-btn" style="position:relative">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/></svg>
      <span class="notification-badge" id="notif-badge" style="display:none">0</span>
    </a>
    <div class="topbar-avatar" id="topbar-avatar">SA</div>
  </div>
</header>

<!-- PAGE CONTENT -->
<div class="page-content">

  <!-- HERO CARD -->
  <div class="hero-card">
    <div class="hero-text">
      <div class="hero-greeting" id="dashboard-greeting">Good Evening, User</div>
      <div class="hero-sub">Let's boost your academic potential!</div>
      <div class="hero-badges">
        <a href="tasks.html" class="hero-badge">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:14px;height:14px"><path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
          View Tasks
        </a>
        <a href="study-plan.html" class="hero-badge">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:14px;height:14px"><path d="M12 4v16m8-8H4"/></svg>
          Add Plan
        </a>
      </div>
    </div>
    <div class="hero-stat">
      <div class="hero-stat-number" id="tasks-due-count">0</div>
      <div class="hero-stat-label">Tasks Due<br>This Week</div>
    </div>
  </div>

  <!-- AI TOOLS -->
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:20px">
    <div class="ai-panel">
      <div class="ai-panel-header">
        <div class="ai-panel-title">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:16px;height:16px;color:var(--primary)"><path d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
          Analyze Workload
        </div>
        <svg class="ai-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:16px;height:16px;color:var(--text-muted)"><path d="M19 9l-7 7-7-7"/></svg>
      </div>
      <div class="ai-panel-body">
        <div class="ai-suggestion-item">Check your tasks page to see pending workload and prioritize accordingly.</div>
        <div class="ai-suggestion-item">Focus on high-priority items first to reduce stress.</div>
      </div>
    </div>
    <div class="ai-panel">
      <div class="ai-panel-header">
        <div class="ai-panel-title">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:16px;height:16px;color:var(--accent)"><path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg>
          Smart Suggestions
        </div>
        <svg class="ai-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:16px;height:16px;color:var(--text-muted)"><path d="M19 9l-7 7-7-7"/></svg>
      </div>
      <div class="ai-panel-body">
        <div class="ai-suggestion-item">Review past performance data and track improvements month by month.</div>
        <div class="ai-suggestion-item">Create a study plan aligned with your upcoming exams schedule.</div>
      </div>
    </div>
  </div>

  <!-- MAIN GRID -->
  <div class="grid-3" style="align-items:start">

    <!-- Pending Tasks -->
    <div class="card">
      <div class="card-header">
        <div>
          <div class="card-title">Pending Tasks</div>
        </div>
        <a href="tasks.html" class="card-icon-btn" title="View All">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/></svg>
        </a>
      </div>
      <div id="pending-tasks-preview">
        <div class="skeleton" style="height:60px;margin:8px 0"></div>
        <div class="skeleton" style="height:60px;margin:8px 0"></div>
      </div>
      <a href="tasks.html" class="add-task-btn">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 4v16m8-8H4"/></svg>
        New Task
      </a>
    </div>

    <!-- Upcoming Exams -->
    <div class="card">
      <div class="card-header">
        <div>
          <div class="card-title">Upcoming Exams</div>
        </div>
        <a href="exams.html" class="card-icon-btn" title="View All">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/></svg>
        </a>
      </div>
      <div id="upcoming-exams-preview">
        <div class="skeleton" style="height:50px;margin:8px 0"></div>
        <div class="skeleton" style="height:50px;margin:8px 0"></div>
      </div>

      <!-- Today's Plan -->
      <div style="margin-top:20px;padding-top:16px;border-top:1px solid var(--border-light)">
        <div class="card-header" style="margin-bottom:10px">
          <div class="card-title" style="font-size:14px">Study Plan — Today</div>
          <a href="study-plan.html" class="card-icon-btn" title="View Plans">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
          </a>
        </div>
        <div id="today-plan-preview">
          <div class="skeleton" style="height:32px"></div>
        </div>
        <a href="study-plan.html" style="display:flex;align-items:center;justify-content:space-between;margin-top:12px;padding:10px 14px;border:1.5px solid var(--border);border-radius:var(--radius-sm);font-size:13px;font-weight:600;color:var(--text-secondary);text-decoration:none;transition:var(--transition)" onmouseover="this.style.borderColor='var(--primary)';this.style.color='var(--primary)'" onmouseout="this.style.borderColor='var(--border)';this.style.color='var(--text-secondary)'">
          <span>Update Study Plan</span>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:14px;height:14px"><path d="M9 5l7 7-7 7"/></svg>
        </a>
      </div>
    </div>

    <!-- Performance / Stats -->
    <div class="card">
      <div class="card-header">
        <div>
          <div class="card-title">Study Plan</div>
          <div class="card-subtitle">Performance Overview</div>
        </div>
        <a href="performance.html" class="card-icon-btn">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
        </a>
      </div>

      <div class="chart-wrap">
        <canvas id="perf-chart-mini"></canvas>
      </div>

      <div style="margin-top:16px">
        <div class="perf-item">
          <div class="perf-label">Average Grade</div>
          <div style="display:flex;align-items:center;gap:8px">
            <div class="perf-value"><span id="dash-grade">—</span><span class="unit">%</span></div>
          </div>
        </div>
        <div class="perf-bar-wrap"><div class="perf-bar blue" id="dash-grade-bar" style="width:0%"></div></div>

        <div class="perf-item" style="margin-top:12px">
          <div class="perf-label">Task Completion</div>
          <div class="perf-value"><span id="dash-completion">—</span><span class="unit">%</span></div>
        </div>
        <div class="perf-bar-wrap"><div class="perf-bar green" id="dash-completion-bar" style="width:0%"></div></div>
      </div>
    </div>

  </div><!-- /grid-3 -->

</div><!-- /page-content -->
```

  </div><!-- /main-content -->
</div><!-- /app-layout -->

<div id="toast-container" class="toast-container"></div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script src="app.js"></script>

<script>
  // Override canvas for dashboard mini chart
  document.addEventListener('DOMContentLoaded', () => {
    const miniCanvas = document.getElementById('perf-chart-mini');
    if (miniCanvas) {
      // The main drawPerformanceChart targets 'perf-chart', here we alias
      // We override at bottom of page load
      window.__dashboardInit = true;
    }

    const today = new Date();
    document.getElementById('topbar-date').textContent = today.toLocaleDateString('en-US', { weekday:'long', year:'numeric', month:'long', day:'numeric'});
  });

  // Override chart for dashboard (uses perf-chart-mini)
  const _origDrawChart = typeof drawPerformanceChart !== 'undefined' ? drawPerformanceChart : null;
  function drawPerformanceChart(records) {
    const canvasId = document.getElementById('perf-chart') ? 'perf-chart' : 'perf-chart-mini';
    const canvas = document.getElementById(canvasId);
    if (!canvas || !records || !records.length) return;
    const ctx = canvas.getContext('2d');
    const w = canvas.width = canvas.offsetWidth;
    const h = canvas.height = 140;
    ctx.clearRect(0, 0, w, h);
    const grades = records.map(r => r.average_grade || 0);
    const max = 100, min = 0, range = max - min;
    const p = { top: 12, right: 12, bottom: 24, left: 28 };
    const cW = w - p.left - p.right, cH = h - p.top - p.bottom;
    const xStep = cW / (grades.length - 1 || 1);
    const yS = y => cH - ((y - min) / range) * cH;

    ctx.strokeStyle = '#e2e8f0'; ctx.lineWidth = 1;
    [0, 50, 100].forEach(v => {
      const y = p.top + yS(v);
      ctx.beginPath(); ctx.moveTo(p.left, y); ctx.lineTo(w - p.right, y); ctx.stroke();
      ctx.fillStyle = '#94a3b8'; ctx.font = '9px Plus Jakarta Sans'; ctx.textAlign = 'right';
      ctx.fillText(v + '%', p.left - 3, y + 3);
    });

    if (grades.length < 2) return;

    const grad = ctx.createLinearGradient(0, p.top, 0, h - p.bottom);
    grad.addColorStop(0, 'rgba(37,99,235,0.18)');
    grad.addColorStop(1, 'rgba(37,99,235,0)');

    ctx.beginPath();
    ctx.moveTo(p.left, p.top + yS(grades[0]));
    grades.forEach((g, i) => ctx.lineTo(p.left + i * xStep, p.top + yS(g)));
    ctx.lineTo(p.left + (grades.length-1)*xStep, h - p.bottom);
    ctx.lineTo(p.left, h - p.bottom); ctx.closePath();
    ctx.fillStyle = grad; ctx.fill();

    ctx.strokeStyle = '#2563eb'; ctx.lineWidth = 2; ctx.lineJoin = 'round';
    ctx.beginPath();
    grades.forEach((g, i) => {
      const x = p.left + i * xStep, y = p.top + yS(g);
      i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
    });
    ctx.stroke();

    grades.forEach((g, i) => {
      const x = p.left + i * xStep, y = p.top + yS(g);
      ctx.fillStyle = 'white'; ctx.beginPath(); ctx.arc(x, y, 3.5, 0, Math.PI*2); ctx.fill();
      ctx.fillStyle = '#2563eb'; ctx.beginPath(); ctx.arc(x, y, 2.5, 0, Math.PI*2); ctx.fill();
    });
  }
</script>

</body>
</html>